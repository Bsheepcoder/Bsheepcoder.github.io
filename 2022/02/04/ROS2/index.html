

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/page1.png">
  <link rel="icon" href="/img/page1.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#000000">
  <meta name="description" content="参考古月居ROS21讲">
  <meta name="author" content="Tony">
  <meta name="keywords" content="">
  <meta name="description" content="参考古月居ROS21讲">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS之命令与编程实践">
<meta property="og:url" content="https://bsheepcoder.github.io/2022/02/04/ROS2/index.html">
<meta property="og:site_name" content="Q&#39;s blog">
<meta property="og:description" content="参考古月居ROS21讲">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/01/27/LoEtUZnziBNHgFs.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/27/3BrQR1gd7LJMikX.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/30/GjtZrKY7Dd69Qe3.png">
<meta property="og:image" content="https://s2.loli.net/2022/01/31/4UiIe5zwyoPNQ8c.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/01/lE6tIX1o4MOvAep.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/02/IBzXtphTVHlQwAi.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/02/91nXqhFyL8o7DRN.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/F2fNVWSZaBz4gMY.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/j847hsINPvUE1YG.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/tMn1vPh9YaHbxUw.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/K1I6VJjr8okv4LC.png">
<meta property="og:image" content="c:/Users/71041/AppData/Roaming/Typora/typora-user-images/image-20220204095104412.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/Q538qRmdMCoSznU.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/YuZwK5z1vXqSyWR.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/vUdFafQKJ7bzOxs.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/hfjqVNXPDWgdmpJ.png">
<meta property="og:image" content="https://s2.loli.net/2022/02/04/QwdoXSkv97e23ZD.png">
<meta property="article:published_time" content="2022-02-04T02:31:37.960Z">
<meta property="article:modified_time" content="2022-02-08T01:03:41.492Z">
<meta property="article:author" content="Tony">
<meta property="article:tag" content="ROS">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://s2.loli.net/2022/01/27/LoEtUZnziBNHgFs.png">
  
  <title>ROS之命令与编程实践 - Q&#39;s blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/tomorrow-night-bright.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/diy/shubiao.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/bynotes/texiao/source/css/toubudaziji.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"bsheepcoder.github.io","root":"/","version":"1.8.12","typing":{"enable":true,"typeSpeed":5,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#efec02","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":2},"lazyload":{"enable":true,"loading_img":"/img/loading2.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"0wpY18jIxyDKS5O89Sd6fFGh-gzGzoHsz","app_key":"8y2ItNdFctdKBPMHS31S2jbm","server_url":"https://0wpy18ji.lc-cn-n1-shared.com","path":"window.location.pathname"}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>


<body>
  <header style="height: 30vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Q&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/w/w1.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="ROS之命令与编程实践">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-02-04 10:31" pubdate>
        2022年2月4日 上午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      27k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      84 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ROS之命令与编程实践</h1>
            
              <p class="note note-info">
                
                  更新于：2022年2月8日 上午
                
              </p>
            
            <div class="markdown-body">
              <h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>古月居ROS21讲</li>
<li>ROSwiki</li>
</ul>
<h2 id="ROS命令行概述"><a href="#ROS命令行概述" class="headerlink" title="ROS命令行概述"></a>ROS命令行概述</h2><ul>
<li><p>roscore启动命令</p>
</li>
<li><p>rosrun</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rosrun [package_name] [node_name] #允许你使用包名直接运行一个包内的节点(而不需要知道这个包的路径)。<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>rosls</p>
<p>rosls是rosbash命令集中的一部分，它允许你直接按软件包的名称而不是绝对路径执行ls命令(罗列目录).</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rosls beginner_tutorials/<br>CMakeLists.txt  include  package.xml  src<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>roscd log</p>
<p>使用roscd log可以切换到ROS保存日记文件的目录下。需要注意的是，如果你没有执行过任何ROS程序，系统会报错说该目录不存在。</p>
</li>
<li><p>rosed</p>
<p>rosed 是 rosbash 的一部分。利用它可以直接通过package名来获取到待编辑的文件而无需指定该文件的存储路径了。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rosed [package_name] [filename]<br></code></pre></div></td></tr></tbody></table></figure>
<p>这个实例展示了如何编辑roscpp package里的Logger.msg文件。</p>
</li>
<li><p>rospack命令</p>
<p>rospack允许你获取软件包的有关信息</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rospack find roscpp<br>/opt/ros/kinetic/share/roscpp<br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> rospack list 　　　　　　　　　　　　　　   <span class="hljs-comment">#显示出当前的包信息</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> rospack depends1 beginner_tutorials  　　    <span class="hljs-comment">#显示当前包的一级依赖</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> rospack depends beginner_tutorials 　　　　<span class="hljs-comment">#显示当前包的所有依赖</span></span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>rqt</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rqt_graph   #显示计算图<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>rosnode</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rosnode ping  节点名 #测试节点的联通情况<br>rosnode list  #显示全部节点<br>rosnode info  节点名  #显示节点信息<br>rosnode machine #显示当前机器<br>rosnode kill  节点名  #结束一个正在运行的node<br>rosnode cleanup #清除无法访问的节点的注册信息<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>rostopic</p>
  <figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rostopic bw	    #显示主题使用的带宽<br>rostopic delay	#从标题中的时间戳显示主题的延迟<br>rostopic echo	#将消息打印到屏幕,可以显 示在某个话题上发布的数据.<br>rostopic find	#按类型查找主题<br>rostopic hz	    #显示主题的发布率   <br>rostopic info	#打印有关活动主题的信息<br>rostopic list	#列出活动主题<br>      -h, --help                 #(显示此帮助消息并退出)<br>      -b BAGFILE, --bag=BAGFILE  #(列出.bag文件中的主题)<br>      -v, --verbose              #(列出每个主题的完整详细信息)<br>      -p                         #(仅列出发布商)<br>      -s                         #(仅列出订阅者)<br>      --host                     #(按主机名分组)<br>rostopic pub	#将数据发布到主题<br>rostopic type	#打印主题或字段类型,命令用来查看所发布话题的消息类型。<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>rostopic pub</p>
  <figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> rostopic pub /turtle1/cmd_vel geometry_msgs/Twist -r 1 -- <span class="hljs-string">'[2.0, 0.0, 0.0]'</span> <span class="hljs-string">'[0.0, 0.0, 1.8]'</span></span><br><span class="hljs-meta">#</span><span class="bash">发送一条消息给turtlesim，告诉它以2.0大小的线速度和1.8大小的角速度开始移动。</span><br><span class="hljs-meta">#</span><span class="bash">这条命令以1Hz的频率发布速度命令到速度话题上。</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">$</span><span class="bash"> rostopic pub -r 10 /turtle1/cmd_vel geometry_msgs/Twist<span class="hljs-string">"linear:</span></span><br>x:1.0<br>y:0.0<br>z:0.0<br>angular:<br>x:0.0<br>y:0.0<br>z:0.0"<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-string">/turtle1/cmd_vel话题名</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-string">geometry_msgs/Twist消息结构</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-string">-r 表示循环</span></span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>rostopic hz</p>
  <figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> rostopic hz /turtle1/pose</span><br>subscribed to [/turtle1/pose]<br>average rate: 62.486<br>        min: 0.015s max: 0.017s std dev: 0.00047s window: 60<br>average rate: 62.476<br>        min: 0.015s max: 0.018s std dev: 0.00045s window: 122<br>average rate: 62.514<br>        min: 0.014s max: 0.020s std dev: 0.00057s window: 185<br>average rate: 62.506<br>        min: 0.013s max: 0.020s std dev: 0.00061s window: 248<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>rosmsg</p>
  <figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash">rosmsg show geometry_msgs/Twist</span><br>geometry_msgs/Vector3 linear<br>  float64 x<br>  float64 y<br>  float64 z<br>geometry_msgs/Vector3 angular<br>  float64 x<br>  float64 y<br>  float64 z<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>rosbag</p>
<p>   将ROS系统运行过程中的数据录制到一个.bag文件中，然后可以通过回放数据来重现相似的运行过程.退出录制时按Ctrl-C退出该命令，你应该会看到在当前目录下一个以年份、日期和时间命名并以.bag作为后缀的文件。</p>
   <figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">录制所有发布的话题,其中 -a 选项，该选项表示将当前发布的所有话题数据都录制保存到一个bag文件中。</span><br><span class="hljs-meta">$</span><span class="bash"> rosbag record -a</span> <br><span class="hljs-meta">#</span><span class="bash">回放bag文件以再现系统运行过程</span><br><span class="hljs-meta">$</span><span class="bash"> rosbag play &lt;your bagfile&gt;</span><br><span class="hljs-meta">#</span><span class="bash">以某一频率发布消息(控制bag包播放的频率) : rosbag play -r 2</span><br><span class="hljs-meta">#</span><span class="bash">从某一时间节点开始播放发布消息 : rosbag play -s 2</span><br><span class="hljs-meta">$</span><span class="bash"> rosbag info &lt;your bagfile&gt;  <span class="hljs-comment">#rosbag info 查看bag文件信息</span></span><br><span class="hljs-meta">$</span><span class="bash"> rosbag record -O 2018-12.bag  /turtle1/command_velocity /turtle1/pose</span><br><span class="hljs-meta">#</span><span class="bash">rosbag record命令支持只录制某些特别指定的话题到单个bag文件中，这样就允许用户只录制他们感兴趣的话题</span><br><span class="hljs-meta">$</span><span class="bash"> rosbag record -a -O 2018-12.bag</span><br><span class="hljs-meta">#</span><span class="bash">可以使用rosbag info 2018-12.bag 命令查看录制时指定话题的信息.</span><br><span class="hljs-meta">#</span><span class="bash">也可以只指定bag包的文件名，录制所有数据</span><br><span class="hljs-meta">$</span><span class="bash"> rosbag record --split --duration=5m -e /radar/back_targets /vehicle_speed /imu_data</span><br><span class="hljs-meta">#</span><span class="bash">录取指定topic，并且每五分钟分割一次, -e为正则匹配。</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun image_view image_view image:=/camera/front_middle compressed</span><br><span class="hljs-meta">#</span><span class="bash">如果查看视频，就可以实现视频播放功能</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
</ul>
<h2 id="创建工作空间和功能包"><a href="#创建工作空间和功能包" class="headerlink" title="创建工作空间和功能包"></a>创建工作空间和功能包</h2><p>工程文件 workspace</p>
<p>四个文件夹：</p>
<ul>
<li>src代码空间</li>
<li>build编译空间</li>
<li>devel开发空间</li>
<li>install安装空间</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">创建工作空间</span><br><span class="hljs-meta">$</span><span class="bash"> mkdir -p ~/catkin_ws/src</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws/src</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_init_workspace</span><br><span class="hljs-meta">#</span><span class="bash">编译工作空间</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws/</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_make</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_make install</span><br><span class="hljs-meta">#</span><span class="bash">设置环境变量</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> devel/setup.bash</span> <br><span class="hljs-meta">#</span><span class="bash">检查环境变量</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$ROS_PACKAGE_PATH</span></span> <br>home/qxd/catkin_ws/src:/opt/ros/melodic/share<br><span class="hljs-meta">#</span><span class="bash">创建功能包</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws/src</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_create_pkg test_pkg std_msgs rospy roscpp</span><br>eg： $ catkin_create_pkg 包名 依赖名 依赖名 依赖名 ...<br><span class="hljs-meta">#</span><span class="bash">编译功能包</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_make</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> ~/catkin_ws/devel/setup.bash</span><br></code></pre></div></td></tr></tbody></table></figure>
<h2 id="发布者publisher编程实现"><a href="#发布者publisher编程实现" class="headerlink" title="发布者publisher编程实现"></a>发布者publisher编程实现</h2><p><img src="https://s2.loli.net/2022/01/27/LoEtUZnziBNHgFs.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">创建功能包</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws/src</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_create_pkg learning_topic std_msgs rospy roscpp geometry_msgs turtlesim</span><br></code></pre></div></td></tr></tbody></table></figure>
<p><img src="https://s2.loli.net/2022/01/27/3BrQR1gd7LJMikX.png" srcset="/img/loading2.gif" lazyload alt="image-20220127193532123"></p>
<p>代码放到src目录</p>
<p>创建一个.cpp文件即可，==注意文件名不能重复！！==</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 该程序将发布turtle1/cmd_vel话题，消息类型geometry——msgs::Twist</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>{<br>        <span class="hljs-comment">//ROS节点初始化</span><br>        ros::<span class="hljs-built_in">init</span>(argc,argv,<span class="hljs-string">"velocity_publisher"</span>);<br><br>        <span class="hljs-comment">//创建节点句柄</span><br>        ros::NodeHandle n;<br><br>        <span class="hljs-comment">//创建一个Publisher，发布名为/turtle1/cmd_vel的topic，消息类型为geometry——msgs::Twist，队列长度10</span><br>        ros::Publisher turtle_vel_pub = n.advertise&lt;geometry_msgs::Twist&gt;(<span class="hljs-string">"/turtle1/cmd_vel"</span>,<span class="hljs-number">10</span>);<br><br>        <span class="hljs-comment">//设置循环频率</span><br>        <span class="hljs-function">ros::Rate <span class="hljs-title">loop_rate</span><span class="hljs-params">(<span class="hljs-number">10</span>)</span></span>;<br><br>        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span>(ros::<span class="hljs-built_in">ok</span>())<br>        {<br>                <span class="hljs-comment">//初始化geometry_msgs::Twist类型的消息</span><br>                geometry_msgs::Twist vel_msg;<br>                vel_msg.linear.x = <span class="hljs-number">0.5</span>;<br>                vel_msg.angular.z = <span class="hljs-number">0.2</span>;<br><br>                <span class="hljs-comment">//发布消息</span><br>                turtle_vel_pub.<span class="hljs-built_in">publish</span>(vel_msg);<br>                <span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Publsh turtle velocity command[%0.2f m/s,%0.2f rad/s]"</span>,<br>vel_msg.linear.x,vel_msg.angular.z);<br><br>                <span class="hljs-comment">//按照循环频率延时</span><br>                loop_rate.<span class="hljs-built_in">sleep</span>();<br>        }<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><br></code></pre></div></td></tr></tbody></table></figure>
<p>接下来需要编译运行,需要配置CMakeLists.txt中的编译规则</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">cmake_minimum_required(VERSION 3.0.2)<br>project(learning_topic)<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Compile as C++11, supported in ROS Kinetic and newer</span></span><br><span class="hljs-meta">#</span><span class="bash"> add_compile_options(-std=c++11)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Find catkin macros and libraries</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># if COMPONENTS list like find_package(catkin REQUIRED COMPONENTS xyz)</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># is used, also find other catkin packages</span></span><br>find_package(catkin REQUIRED COMPONENTS<br>  geometry_msgs<br>  roscpp<br>  rospy<br>  std_msgs<br>  turtlesim<br>  message_generation<br>)<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># System dependencies are found with CMake's conventions</span></span><br><span class="hljs-meta">#</span><span class="bash"> find_package(Boost REQUIRED COMPONENTS system)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Uncomment this if the package has a setup.py. This macro ensures</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># modules and global scripts declared therein get installed</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># See http://ros.org/doc/api/catkin/html/user_guide/setup_dot_py.html</span></span><br><span class="hljs-meta">#</span><span class="bash"> catkin_python_setup()</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">###############################################</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Declare ROS messages, services and actions ##</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">###############################################</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># To declare and build messages, services or actions from within this</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># package, follow these steps:</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># * Let MSG_DEP_SET be the set of packages whose message types you use in</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   your messages/services/actions (e.g. std_msgs, actionlib_msgs, ...).</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># * In the file package.xml:</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * add a build_depend tag for "message_generation"</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * add a build_depend and a exec_depend tag for each package in MSG_DEP_SET</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * If MSG_DEP_SET isn't empty the following dependency has been pulled in</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#     but can be declared for certainty nonetheless:</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#     * add a exec_depend tag for "message_runtime"</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># * In this file (CMakeLists.txt):</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * add "message_generation" and every package in MSG_DEP_SET to</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#     find_package(catkin REQUIRED COMPONENTS ...)</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * add "message_runtime" and every package in MSG_DEP_SET to</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#     catkin_package(CATKIN_DEPENDS ...)</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * uncomment the add_*_files sections below as needed</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#     and list every .msg/.srv/.action file to be processed</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * uncomment the generate_messages entry below</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * add every package in MSG_DEP_SET to generate_messages(DEPENDENCIES ...)</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Generate messages in the 'msg' folder</span></span><br><span class="hljs-meta">#</span><span class="bash"> add_message_files(</span><br><span class="hljs-meta">#</span><span class="bash">   FILES</span><br><span class="hljs-meta">#</span><span class="bash">   Message1.msg</span><br><span class="hljs-meta">#</span><span class="bash">   Message2.msg</span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Generate services in the 'srv' folder</span></span><br><span class="hljs-meta">#</span><span class="bash"> add_service_files(</span><br><span class="hljs-meta">#</span><span class="bash">   FILES</span><br><span class="hljs-meta">#</span><span class="bash">   Service1.srv</span><br><span class="hljs-meta">#</span><span class="bash">   Service2.srv</span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Generate actions in the 'action' folder</span></span><br><span class="hljs-meta">#</span><span class="bash"> add_action_files(</span><br><span class="hljs-meta">#</span><span class="bash">   FILES</span><br><span class="hljs-meta">#</span><span class="bash">   Action1.action</span><br><span class="hljs-meta">#</span><span class="bash">   Action2.action</span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Generate added messages and services with any dependencies listed here</span></span><br><span class="hljs-meta">#</span><span class="bash"> generate_messages(</span><br><span class="hljs-meta">#</span><span class="bash">   DEPENDENCIES</span><br><span class="hljs-meta">#</span><span class="bash">   geometry_msgs<span class="hljs-comment">#   std_msgs</span></span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><br>add_message_files(FILES Person.msg)<br>generate_messages(DEPENDENCIES std_msgs)<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">###############################################</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Declare ROS dynamic reconfigure parameters ##</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">###############################################</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># To declare and build dynamic reconfigure parameters within this</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># package, follow these steps:</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># * In the file package.xml:</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * add a build_depend and a exec_depend tag for "dynamic_reconfigure"</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># * In this file (CMakeLists.txt):</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * add "dynamic_reconfigure" to</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#     find_package(catkin REQUIRED COMPONENTS ...)</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#   * uncomment the "generate_dynamic_reconfigure_options" section below</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">#     and list every .cfg file to be processed</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Generate dynamic reconfigure parameters in the 'cfg' folder</span></span><br><span class="hljs-meta">#</span><span class="bash"> generate_dynamic_reconfigure_options(</span><br><span class="hljs-meta">#</span><span class="bash">   cfg/DynReconf1.cfg</span><br><span class="hljs-meta">#</span><span class="bash">   cfg/DynReconf2.cfg</span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##################################</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># catkin specific configuration ##</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##################################</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># The catkin_package macro generates cmake config files for your package</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Declare things to be passed to dependent projects</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># INCLUDE_DIRS: uncomment this if your package contains header files</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># LIBRARIES: libraries you create in this project that dependent projects also need</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># CATKIN_DEPENDS: catkin_packages dependent projects also need</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># DEPENDS: system dependencies of this project that dependent projects also need</span></span><br>catkin_package(<br><span class="hljs-meta">#</span><span class="bash">  INCLUDE_DIRS include</span><br><span class="hljs-meta">#</span><span class="bash">  LIBRARIES learning_topic</span><br><span class="hljs-meta">#</span><span class="bash">  CATKIN_DEPENDS geometry_msgs roscpp rospy std_msgs turtlesim</span><br><span class="hljs-meta">#</span><span class="bash">  DEPENDS system_lib</span><br>        message_runtime<br>)<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##########</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Build ##</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##########</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Specify additional locations of header files</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Your package locations should be listed before other locations</span></span><br>include_directories(<br><span class="hljs-meta">#</span><span class="bash"> include</span><br><span class="hljs-meta">  $</span><span class="bash">{catkin_INCLUDE_DIRS}</span><br>)<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Declare a C++ library</span></span><br><span class="hljs-meta">#</span><span class="bash"> add_library(<span class="hljs-variable">${PROJECT_NAME}</span></span><br><span class="hljs-meta">#</span><span class="bash">   src/<span class="hljs-variable">${PROJECT_NAME}</span>/learning_topic.cpp</span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Add cmake target dependencies of the library</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># as an example, code may need to be generated before libraries</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># either from message generation or dynamic reconfigure</span></span><br><span class="hljs-meta">#</span><span class="bash"> add_dependencies(<span class="hljs-variable">${PROJECT_NAME}</span> <span class="hljs-variable">${<span class="hljs-variable">${PROJECT_NAME}</span>_EXPORTED_TARGETS}</span> <span class="hljs-variable">${catkin_EXPORTED_TARGETS}</span>)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Declare a C++ executable</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># With catkin_make all packages are built within a single CMake context</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># The recommended prefix ensures that target names across packages don't collide</span></span><br><span class="hljs-meta">#</span><span class="bash"> add_executable(<span class="hljs-variable">${PROJECT_NAME}</span>_node src/learning_topic_node.cpp)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Rename C++ executable without prefix</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># The above recommended prefix causes long target names, the following renames the</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># target back to the shorter version for ease of user use</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># e.g. "rosrun someones_pkg node" instead of "rosrun someones_pkg someones_pkg_node"</span></span><br><span class="hljs-meta">#</span><span class="bash"> set_target_properties(<span class="hljs-variable">${PROJECT_NAME}</span>_node PROPERTIES OUTPUT_NAME node PREFIX <span class="hljs-string">""</span>)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Add cmake target dependencies of the executable</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># same as for the library above</span></span><br><span class="hljs-meta">#</span><span class="bash"> add_dependencies(<span class="hljs-variable">${PROJECT_NAME}</span>_node <span class="hljs-variable">${<span class="hljs-variable">${PROJECT_NAME}</span>_EXPORTED_TARGETS}</span> <span class="hljs-variable">${catkin_EXPORTED_TARGETS}</span>)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Specify libraries to link a library or executable target against</span></span><br><span class="hljs-meta">#</span><span class="bash"> target_link_libraries(<span class="hljs-variable">${PROJECT_NAME}</span>_node</span><br><span class="hljs-meta">#</span><span class="bash">   <span class="hljs-variable">${catkin_LIBRARIES}</span></span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">将velocity_publisher.cpp编译成velocity_publisher可执行文件</span><br>add_executable(velocity_publisher src/velocity_publisher.cpp)<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">对velocity_publisher做可执行文件的链接</span><br>target_link_libraries(velocity_publisher ${catkin_LIBRARIES})<br><br>add_executable(pose_subscriber src/pose_subscriber.cpp)<br>target_link_libraries(pose_subscriber ${catkin_LIBRARIES})<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">############</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Install ##</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">############</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"> all install targets should use catkin DESTINATION variables</span><br><span class="hljs-meta">#</span><span class="bash"> See http://ros.org/doc/api/catkin/html/adv_user_guide/variables.html</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Mark executable scripts (Python etc.) for installation</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># in contrast to setup.py, you can choose the destination</span></span><br><span class="hljs-meta">#</span><span class="bash"> catkin_install_python(PROGRAMS</span><br><span class="hljs-meta">#</span><span class="bash">   scripts/my_python_script</span><br><span class="hljs-meta">#</span><span class="bash">   DESTINATION <span class="hljs-variable">${CATKIN_PACKAGE_BIN_DESTINATION}</span></span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Mark executables for installation</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># See http://docs.ros.org/melodic/api/catkin/html/howto/format1/building_executables.html</span></span><br><span class="hljs-meta">#</span><span class="bash"> install(TARGETS <span class="hljs-variable">${PROJECT_NAME}</span>_node</span><br><span class="hljs-meta">#</span><span class="bash">   RUNTIME DESTINATION <span class="hljs-variable">${CATKIN_PACKAGE_BIN_DESTINATION}</span></span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Mark libraries for installation</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># See http://docs.ros.org/melodic/api/catkin/html/howto/format1/building_libraries.html</span></span><br><span class="hljs-meta">#</span><span class="bash"> install(TARGETS <span class="hljs-variable">${PROJECT_NAME}</span></span><br><span class="hljs-meta">#</span><span class="bash">   ARCHIVE DESTINATION <span class="hljs-variable">${CATKIN_PACKAGE_LIB_DESTINATION}</span></span><br><span class="hljs-meta">#</span><span class="bash">   LIBRARY DESTINATION <span class="hljs-variable">${CATKIN_PACKAGE_LIB_DESTINATION}</span></span><br><span class="hljs-meta">#</span><span class="bash">   RUNTIME DESTINATION <span class="hljs-variable">${CATKIN_GLOBAL_BIN_DESTINATION}</span></span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Mark cpp header files for installation</span></span><br><span class="hljs-meta">#</span><span class="bash"> install(DIRECTORY include/<span class="hljs-variable">${PROJECT_NAME}</span>/</span><br><span class="hljs-meta">#</span><span class="bash">   DESTINATION <span class="hljs-variable">${CATKIN_PACKAGE_INCLUDE_DESTINATION}</span></span><br><span class="hljs-meta">#</span><span class="bash">   FILES_MATCHING PATTERN <span class="hljs-string">"*.h"</span></span><br><span class="hljs-meta">#</span><span class="bash">   PATTERN <span class="hljs-string">".svn"</span> EXCLUDE</span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Mark other files for installation (e.g. launch and bag files, etc.)</span></span><br><span class="hljs-meta">#</span><span class="bash"> install(FILES</span><br><span class="hljs-meta">#</span><span class="bash">   <span class="hljs-comment"># myfile1</span></span><br><span class="hljs-meta">#</span><span class="bash">   <span class="hljs-comment"># myfile2</span></span><br><span class="hljs-meta">#</span><span class="bash">   DESTINATION <span class="hljs-variable">${CATKIN_PACKAGE_SHARE_DESTINATION}</span></span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">############</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Testing ##</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">############</span></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Add gtest based cpp test target and link libraries</span></span><br><span class="hljs-meta">#</span><span class="bash"> catkin_add_gtest(<span class="hljs-variable">${PROJECT_NAME}</span>-<span class="hljs-built_in">test</span> <span class="hljs-built_in">test</span>/test_learning_topic.cpp)</span><br><span class="hljs-meta">#</span><span class="bash"> <span class="hljs-keyword">if</span>(TARGET <span class="hljs-variable">${PROJECT_NAME}</span>-<span class="hljs-built_in">test</span>)</span><br><span class="hljs-meta">#</span><span class="bash">   target_link_libraries(<span class="hljs-variable">${PROJECT_NAME}</span>-<span class="hljs-built_in">test</span> <span class="hljs-variable">${PROJECT_NAME}</span>)</span><br><span class="hljs-meta">#</span><span class="bash"> endif()</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Add folders to be run by python nosetests</span></span><br><span class="hljs-meta">#</span><span class="bash"> catkin_add_nosetests(<span class="hljs-built_in">test</span>)</span><br><br></code></pre></div></td></tr></tbody></table></figure>
<p>接下来就可以编译,在你的工作空间的src下</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> catkin_make</span><br></code></pre></div></td></tr></tbody></table></figure>
<p>设置环境变量</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">source devel/setup.bash<br></code></pre></div></td></tr></tbody></table></figure>
<p>也可以在主文件夹下</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">cd /<br>ls -a<br>vim .bashrc<br><span class="hljs-meta">#</span><span class="bash">最后一行添加  <span class="hljs-built_in">source</span> /home/qxd/catkin_ws/devel/setup.bash</span><br></code></pre></div></td></tr></tbody></table></figure>
<p>接下来就可以执行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> roscore</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun turtlesim turtlesim_node</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun learning_topic velocity_publisher</span><br></code></pre></div></td></tr></tbody></table></figure>
<p>也可用python来完成,首行注意添加 #!/usr/bin/env python</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python   </span><br><span class="hljs-keyword">import</span> rospy<br><span class="hljs-keyword">from</span> geometry_msgs.msg <span class="hljs-keyword">import</span> Twist<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">velocity_publisher</span>():</span><br>    <span class="hljs-comment">#ROS</span><br>    rospy.init_node(<span class="hljs-string">'velocity_publisher'</span>,anonymous=<span class="hljs-literal">True</span>)<br>    <br>    turtle_vel_pub = rospy.Publisher(<span class="hljs-string">'/turtle1/cmd_vel'</span>,Twist,queue_size=<span class="hljs-number">10</span>)<br>    <br>    rate = rospy.Rate(<span class="hljs-number">10</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> rospy.is_shutdown():<br>        vel_msg = Twist()<br>        vel_msg.linear.x = <span class="hljs-number">0.5</span><br>        vel_msg.angular.z = <span class="hljs-number">0.2</span><br>        <br>        turtle_vel_pub.publish(vel_msg)<br>        rospy.loginfo(<span class="hljs-string">"Publish turtle velocity command[%0.2f m/s,%0.2f rad/s]"</span>,<br>                vel_msg.linear.x,vel_msg.angular.z)<br>        rate.sleep()<br>        <br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    <span class="hljs-keyword">try</span>:<br>        velocity_publisher()<br>    <span class="hljs-keyword">except</span> rospy.ROSInterruptException:<br>        <span class="hljs-keyword">pass</span><br></code></pre></div></td></tr></tbody></table></figure>
<h2 id="订阅者subscriber的编程实现"><a href="#订阅者subscriber的编程实现" class="headerlink" title="订阅者subscriber的编程实现"></a>订阅者subscriber的编程实现</h2><p><img src="https://s2.loli.net/2022/01/30/GjtZrKY7Dd69Qe3.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<p>项目工程文件夹下src中创建代码</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">//pose_subscriber.CPP</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * this program will subscribe /turtle/pose topic,message type is turtlesim::pose</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">"turtlesim/Pose.h"</span></span><br><br><span class="hljs-comment">//recived the subscribe,then will go into the function that message recall</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">poseCallback</span><span class="hljs-params">(<span class="hljs-keyword">const</span> turtlesim::Pose::ConstPtr&amp; msg)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Turtle pose: x:%0.6f,y:%0.6f"</span>,msg-&gt;x,msg-&gt;y);<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">//初始化ROS节点</span><br>    ros::<span class="hljs-built_in">init</span>(argc,argv,<span class="hljs-string">"pose_subscriber"</span>);<br><br>    <span class="hljs-comment">//创建节点句柄</span><br>    ros::NodeHandle n;<br><br>    <span class="hljs-comment">//创建一个Subscriber，订阅名为/turtle1/pose的topic,注册回调函数poseCallback</span><br>    ros::Subscriber pose_sub = n.<span class="hljs-built_in">subscribe</span>(<span class="hljs-string">"/turtle1/pose"</span>,<span class="hljs-number">10</span>,poseCallback);<br><br>    <span class="hljs-comment">//循环等待回调函数</span><br>    ros::<span class="hljs-built_in">spin</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}          <br></code></pre></div></td></tr></tbody></table></figure>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">编译执行过程同发布者<br></code></pre></div></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment">#-*- coding: utf-8 -*-</span><br><span class="hljs-comment">#该例程将订阅/turtle1/pose话题，消息类型turtlesim::Pose</span><br><br><span class="hljs-keyword">import</span> rospy<br><span class="hljs-keyword">from</span> turtlesim.msg <span class="hljs-keyword">import</span> Pose<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">poseCallback</span>(<span class="hljs-params">msg</span>):</span><br>    rospy.loginfo(<span class="hljs-string">"Turtle pose: x:%0.6f,y:%0.6f"</span>,msg.x,msg.y)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pose_subscriber</span>():</span><br>    rospy.init_node(<span class="hljs-string">'pose_subscriber'</span>,anonymous=<span class="hljs-literal">True</span>)<br>    <br>    rospy.Subscriber(<span class="hljs-string">"/turtle1/pose"</span>,Pose,poseCallback)<br>    <br>    rospy.spin()<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    pose_subscriber()<br></code></pre></div></td></tr></tbody></table></figure>
<h2 id="话题消息定义与使用"><a href="#话题消息定义与使用" class="headerlink" title="话题消息定义与使用"></a>话题消息定义与使用</h2><p>如何自定义一个话题的消息</p>
<ul>
<li><p>定义msg文件</p>
<p>在项目文件夹下创建一个msg文件夹，专门存放.msg文件,不能随便命名</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">string name<br>uint8 sex<br>uint8 age<br><br>uint8 unknown = 0<br>uint8 male = 1<br>uint8 female =2<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>在package.xml中添加功能包依赖</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">&lt;build_depend&gt;message_generation&lt;/build_depend&gt;<br>&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>在CMakeList.txt添加编译选项</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Find catkin macros and libraries</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># if COMPONENTS list like find_package(catkin REQUIRED COMPONENTS xyz)</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># is used, also find other catkin packages</span></span><br>find_package(catkin REQUIRED COMPONENTS<br>  geometry_msgs<br>  roscpp<br>  rospy<br>  std_msgs<br>  turtlesim<br>  message_generation   #添加功能包<br> )<br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Generate added messages and services with any dependencies listed here</span></span><br><span class="hljs-meta">#</span><span class="bash"> generate_messages(</span><br><span class="hljs-meta">#</span><span class="bash">   DEPENDENCIES</span><br><span class="hljs-meta">#</span><span class="bash">   geometry_msgs<span class="hljs-comment">#   std_msgs</span></span><br><span class="hljs-meta">#</span><span class="bash"> )</span><br>add_message_files(FILES Person.msg)<br>generate_messages(DEPENDENCIES std_msgs)<br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##################################</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># catkin specific configuration ##</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment">##################################</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># The catkin_package macro generates cmake config files for your package</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># Declare things to be passed to dependent projects</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># INCLUDE_DIRS: uncomment this if your package contains header files</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># LIBRARIES: libraries you create in this project that dependent projects also need</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># CATKIN_DEPENDS: catkin_packages dependent projects also need</span></span><br><span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># DEPENDS: system dependencies of this project that dependent projects also need</span></span><br>catkin_package(<br><span class="hljs-meta">#</span><span class="bash">  INCLUDE_DIRS include</span><br><span class="hljs-meta">#</span><span class="bash">  LIBRARIES learning_topic</span><br>   CATKIN_DEPENDS geometry_msgs roscpp rospy std_msgs turtlesim message_runtime  #添加此处<br><span class="hljs-meta">#</span><span class="bash">  DEPENDS system_lib</span><br>)<br><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>最后直接编译catkin_make编译即可</p>
</li>
</ul>
<p>​    </p>
<h2 id="客户端Client的编程实现"><a href="#客户端Client的编程实现" class="headerlink" title="客户端Client的编程实现"></a>客户端Client的编程实现</h2><p><img src="https://s2.loli.net/2022/01/31/4UiIe5zwyoPNQ8c.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<ul>
<li><p>创建一个新的功能包文件夹</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws/src</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_create_pkg learnin_service roscpp rospy std_msgs geometry_msgs turtlesim</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>在learnin_service的src下创建cpp代码</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment">*该程序将请求/spawn服务，服务数据类型turtlesim::Spawn</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;turtlesim/Spawn.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">//初始化ROS节点</span><br>    ros::<span class="hljs-built_in">init</span>(argc,argv,<span class="hljs-string">"turtle_spawn"</span>);<br>    <br>    <span class="hljs-comment">//创建节点句柄</span><br>    ros::NodeHandle node;<br>    <br>    <span class="hljs-comment">//发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span><br>    ros::service::<span class="hljs-built_in">waitForService</span>(<span class="hljs-string">"/spawn"</span>);  <span class="hljs-comment">//循环等待</span><br>    ros::ServiceClient add_turtle = node.serviceClient&lt;turtlesim::Spawn&gt;(<span class="hljs-string">"/spawn"</span>);<br>    <br>    <span class="hljs-comment">//初始化turtlesim::Spawn的请求数据</span><br>    turtlesim::Spawn srv;<br>    srv.request.x = <span class="hljs-number">2.0</span>;<br>    srv.request.y = <span class="hljs-number">2.0</span>;<br>    srv.request.name = <span class="hljs-string">"turtle2"</span>;<br>    <br>    <span class="hljs-comment">//请求服务调用</span><br>    <span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Call service to spwan turtle[x:%0.6f,y:%0.6f,name:%s]"</span>,srv.request.x,srv.request.y,srv.request.name.<span class="hljs-built_in">c_str</span>());<br>    <br>    add_turtle.<span class="hljs-built_in">call</span>(srv);<br>    <br>    <span class="hljs-comment">//显示服务调用结果</span><br>    <span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Spwan turtle successfully [name:%s]"</span>,srv.response.name.<span class="hljs-built_in">c_str</span>());<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></div></td></tr></tbody></table></figure>
<p>配置编译规则CMakeList.txt</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-built_in">add_executable</span>(turtle_spawn src/turtle_spawn.cpp) <span class="hljs-comment">//设置需要编译的代码和生成的可执行文件；</span><br><span class="hljs-built_in">target_link_libraries</span>(turtle_spawn ${catkin_LIBRARIES}) <span class="hljs-comment">//设置链接库；</span><br></code></pre></div></td></tr></tbody></table></figure>
<p>回到根目录/catkin_ws编译并运行客户端</p>
<p>编译成功后在devel/lib下产生功能包</p>
</li>
</ul>
<h2 id="服务端Server的编程实现"><a href="#服务端Server的编程实现" class="headerlink" title="服务端Server的编程实现"></a>服务端Server的编程实现</h2><p><img src="https://s2.loli.net/2022/02/01/lE6tIX1o4MOvAep.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<p>​    在src下turtle_command_server.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 该程序将执行/turtle_command服务，服务数据类型td_srvs/Trigger</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;std_srvs/Trigger.h&gt;</span></span><br><br>ros::Publisher turtle_vel_pub;<br><span class="hljs-keyword">bool</span> pubCommand = <span class="hljs-literal">false</span>;<br><br><span class="hljs-comment">// service回调函数，输入参数req，输出参数res</span><br><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">commandCallback</span><span class="hljs-params">(std_srvs::Trigger::Request  &amp;req,</span></span><br><span class="hljs-params"><span class="hljs-function">         			std_srvs::Trigger::Response &amp;res)</span></span><br><span class="hljs-function"></span>{<br>	pubCommand = !pubCommand;<br><br>    <span class="hljs-comment">//显示请求数据</span><br>    <span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Publish turtle velocity command [%s]"</span>, pubCommand==<span class="hljs-literal">true</span>?<span class="hljs-string">"Yes"</span>:<span class="hljs-string">"No"</span>);<br><br>	<span class="hljs-comment">//设置反馈数据</span><br>	res.success = <span class="hljs-literal">true</span>;<br>	res.message = <span class="hljs-string">"Change turtle command state!"</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">//ROS节点初始化</span><br>    ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">"turtle_command_server"</span>);<br>    <span class="hljs-comment">//创建节点"把手"</span><br>    ros::NodeHandle n;<br>    <span class="hljs-comment">//创建一个名为turtle_command的erver，注册回调函数ommandCallback</span><br>    ros::ServiceServer command_service = n.<span class="hljs-built_in">advertiseService</span>(<span class="hljs-string">"/turtle_command"</span>, commandCallback);<br>	<span class="hljs-comment">// 创建一个Publisher,发布名为turtle1/cmd_vel的topic消息类型为geometry_msgs::Twist，队列长度为10</span><br>	turtle_vel_pub = n.advertise&lt;geometry_msgs::Twist&gt;(<span class="hljs-string">"/turtle1/cmd_vel"</span>, <span class="hljs-number">10</span>);<br>    <span class="hljs-comment">//循环等待回调函数</span><br>    <span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Ready to receive turtle command."</span>);<br>	<span class="hljs-comment">//设置循环的频率</span><br>	<span class="hljs-function">ros::Rate <span class="hljs-title">loop_rate</span><span class="hljs-params">(<span class="hljs-number">10</span>)</span></span>;<br>	<span class="hljs-keyword">while</span>(ros::<span class="hljs-built_in">ok</span>())<br>	{<br>		<span class="hljs-comment">//查看一次回调函数队列</span><br>    	ros::<span class="hljs-built_in">spinOnce</span>();<br>		<span class="hljs-comment">//如果标志为true，则发布速度指令</span><br>		<span class="hljs-keyword">if</span>(pubCommand)<br>		{<br>			geometry_msgs::Twist vel_msg;<br>			vel_msg.linear.x = <span class="hljs-number">0.5</span>;<br>			vel_msg.angular.z = <span class="hljs-number">0.2</span>;<br>			turtle_vel_pub.<span class="hljs-built_in">publish</span>(vel_msg);<br>		}<br>		<span class="hljs-comment">//按照循环频率延时</span><br>	    loop_rate.<span class="hljs-built_in">sleep</span>();<br>	}<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></div></td></tr></tbody></table></figure>
<p>配置CMakeLists</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">add_executable(turtle_command_server src/turtle_command_server.cpp)<br>target_link_libraries(turtle_command_server ${catkin_LIBRARIES})<br></code></pre></div></td></tr></tbody></table></figure>
<p>编译运行服务器</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_make</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> devel/setup.bash</span>  <br><span class="hljs-meta">$</span><span class="bash"> roscore</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun turtlesim turtlesim_node</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun learning_service turtle_command_server</span><br><span class="hljs-meta">$</span><span class="bash"> rosservice call /turtle_command <span class="hljs-string">"{}"</span></span><br></code></pre></div></td></tr></tbody></table></figure>
<h2 id="自定义服务数据"><a href="#自定义服务数据" class="headerlink" title="自定义服务数据"></a>自定义服务数据</h2><ul>
<li><p>定义srv文件</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp">string name<br>uint8 age<br>uint8 sex<br>uint8 unknown = <span class="hljs-number">0</span><br>uint8 male = <span class="hljs-number">1</span><br>uint8 female = <span class="hljs-number">2</span><br>---   <span class="hljs-comment">//之上表示request，之下表示respons</span><br>string result<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>在package.xml中添加功能包依赖</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">&lt;build_depend&gt;message_generation&lt;/build_depend&gt;<br>&lt;exec_depend&gt;message_runtime&lt;/exec_depend&gt;<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>在CMakeLists.txt提娜佳编译选项</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">find_package( …… message_generation)<br>add_service_files(FILES Person.srv)<br>generate_messages(DEPENDENCIES std_msgs)<br>catkin_package(…… message_runtime)<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>编译生成语言相关文件</p>
</li>
<li><p>服务端实现</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 该例程将请求/show_person服务，服务数据类型learning_service::Person</span><br><span class="hljs-comment"> */</span><br> <br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"learning_service/Person.h"</span></span><br><br><span class="hljs-comment">// service回调函数，输入参数req，输出参数res</span><br><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">personCallback</span><span class="hljs-params">(learning_service::Person::Request  &amp;req,</span></span><br><span class="hljs-params"><span class="hljs-function">         			learning_service::Person::Response &amp;res)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// 显示请求数据</span><br>    <span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Person: name:%s  age:%d  sex:%d"</span>, req.name.<span class="hljs-built_in">c_str</span>(), req.age, req.sex);<br><br>	<span class="hljs-comment">// 设置反馈数据</span><br>	res.result = <span class="hljs-string">"OK"</span>;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// ROS节点初始化</span><br>    ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">"person_server"</span>);<br><br>    <span class="hljs-comment">// 创建节点句柄</span><br>    ros::NodeHandle n;<br><br>    <span class="hljs-comment">// 创建一个名为show_person的erver，注册回调函数ersonCallback</span><br>    ros::ServiceServer person_service = n.<span class="hljs-built_in">advertiseService</span>(<span class="hljs-string">"/show_person"</span>, personCallback);<br><br>    <span class="hljs-comment">// 循环等待回调函数</span><br>    <span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Ready to show person informtion."</span>);<br>    ros::<span class="hljs-built_in">spin</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br><br><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>客户端实现</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 该例程将请求/show_person服务，服务数据类型learning_service::Person</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"learning_service/Person.h"</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// 初始化ROS节点</span><br>	ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">"person_client"</span>);<br><br>    <span class="hljs-comment">// 创建节点句柄</span><br>	ros::NodeHandle node;<br><br>    <span class="hljs-comment">// 发现/spawn服务后，创建一个服务客户端，连接名为/spawn的service</span><br>	ros::service::<span class="hljs-built_in">waitForService</span>(<span class="hljs-string">"/show_person"</span>);<br>	ros::ServiceClient person_client = node.serviceClient&lt;learning_service::Person&gt;(<span class="hljs-string">"/show_person"</span>);<br><br>    <span class="hljs-comment">// 初始化learning_service::Person的请求数据</span><br>	learning_service::Person srv;<br>	srv.request.name = <span class="hljs-string">"Tom"</span>;<br>	srv.request.age  = <span class="hljs-number">20</span>;<br>	srv.request.sex  = learning_service::Person::Request::male;<br><br>    <span class="hljs-comment">// 请求服务调用</span><br>	<span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Call service to show person[name:%s, age:%d, sex:%d]"</span>, <br>			 srv.request.name.<span class="hljs-built_in">c_str</span>(), srv.request.age, srv.request.sex);<br><br>	person_client.<span class="hljs-built_in">call</span>(srv);<br><br>	<span class="hljs-comment">// 显示服务调用结果</span><br>	<span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Show person result : %s"</span>, srv.response.result.<span class="hljs-built_in">c_str</span>());<br><br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>};<br></code></pre></div></td></tr></tbody></table></figure>
<p>配置编译规则</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">add_executable(person_server src/person_server.cpp)<br>target_link_libraries(person_server ${catkin_LIBRARIES})<br>add_dependencies(person_server ${PROJECT_NAME}_gencpp)<br>add_executable(person_client src/person_client.cpp)<br>target_link_libraries(person_client ${catkin_LIBRARIES})<br>add_dependencies(person_client ${PROJECT_NAME}_gencpp)<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>运行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_make</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> devel/setup.bash</span><br><span class="hljs-meta">$</span><span class="bash"> roscore</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun learning_service person_server</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun learning_service person_client</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
</ul>
<h2 id="参数的使用与编程方法"><a href="#参数的使用与编程方法" class="headerlink" title="参数的使用与编程方法"></a>参数的使用与编程方法</h2><p><img src="https://s2.loli.net/2022/02/02/IBzXtphTVHlQwAi.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<ul>
<li><p>创建功能包</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws/src</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_create_pkg learning_parameter roscpp rospy std_srvs</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>参数命令行使用</p>
<p><img src="https://s2.loli.net/2022/02/02/91nXqhFyL8o7DRN.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> rosparam list <span class="hljs-comment">#列出当前多有参数</span></span><br><span class="hljs-meta">$</span><span class="bash"> rosparam get param_key <span class="hljs-comment">#显示某个参数值</span></span><br><span class="hljs-meta">$</span><span class="bash"> rosparam <span class="hljs-built_in">set</span> param_key param_value  <span class="hljs-comment">#设置某个参数值</span></span><br><span class="hljs-meta">$</span><span class="bash"> rosparam dump file_name  <span class="hljs-comment">#保存参数到文件</span></span><br><span class="hljs-meta">$</span><span class="bash"> rosparam load file_name  <span class="hljs-comment">#从文件读取参数</span></span><br><span class="hljs-meta">$</span><span class="bash"> rosparam delete param_key <span class="hljs-comment">#删除参数</span></span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>创建parameter_conflg.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 该例程设置/读取海龟例程中的参数</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;std_srvs/Empty.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>{<br>	<span class="hljs-keyword">int</span> red, green, blue;<br><br>    <span class="hljs-comment">// ROS节点初始化</span><br>    ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">"parameter_config"</span>);<br><br>    <span class="hljs-comment">// 创建节点句柄</span><br>    ros::NodeHandle node;<br><br>    <span class="hljs-comment">// 读取背景颜色参数</span><br>	ros::param::<span class="hljs-built_in">get</span>(<span class="hljs-string">"/background_r"</span>, red);<br>	ros::param::<span class="hljs-built_in">get</span>(<span class="hljs-string">"/background_g"</span>, green);<br>	ros::param::<span class="hljs-built_in">get</span>(<span class="hljs-string">"/background_b"</span>, blue);<br><br>	<span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Get Backgroud Color[%d, %d, %d]"</span>, red, green, blue);<br><br>	<span class="hljs-comment">// 设置背景颜色参数</span><br>	ros::param::<span class="hljs-built_in">set</span>(<span class="hljs-string">"/background_r"</span>, <span class="hljs-number">255</span>);<br>	ros::param::<span class="hljs-built_in">set</span>(<span class="hljs-string">"/background_g"</span>, <span class="hljs-number">255</span>);<br>	ros::param::<span class="hljs-built_in">set</span>(<span class="hljs-string">"/background_b"</span>, <span class="hljs-number">255</span>);<br><br>	<span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Set Backgroud Color[255, 255, 255]"</span>);<br><br>    <span class="hljs-comment">// 读取背景颜色参数</span><br>	ros::param::<span class="hljs-built_in">get</span>(<span class="hljs-string">"/background_r"</span>, red);<br>	ros::param::<span class="hljs-built_in">get</span>(<span class="hljs-string">"/background_g"</span>, green);<br>	ros::param::<span class="hljs-built_in">get</span>(<span class="hljs-string">"/background_b"</span>, blue);<br><br>	<span class="hljs-built_in">ROS_INFO</span>(<span class="hljs-string">"Re-get Backgroud Color[%d, %d, %d]"</span>, red, green, blue);<br><br>	<span class="hljs-comment">// 调用服务，刷新背景颜色</span><br>	ros::service::<span class="hljs-built_in">waitForService</span>(<span class="hljs-string">"/clear"</span>);<br>	ros::ServiceClient clear_background = node.serviceClient&lt;std_srvs::Empty&gt;(<span class="hljs-string">"/clear"</span>);<br>	std_srvs::Empty srv;<br>	clear_background.<span class="hljs-built_in">call</span>(srv);<br>	<br>	<span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>配置CMakeLists参数</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">add_executable(parameter_config src/parameter_config.cpp)<br>target_link_libraries(parameter_config ${catkin_LIBRARIES})<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>编译运行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_make</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> devel/setup.bash</span><br><span class="hljs-meta">$</span><span class="bash"> roscore</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun turtlesim turtlesim_node</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun learning_parameter parameter_config</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
</ul>
<h2 id="ROS中的坐标系管理系统"><a href="#ROS中的坐标系管理系统" class="headerlink" title="ROS中的坐标系管理系统"></a>ROS中的坐标系管理系统</h2><ul>
<li><p>机器人中的坐标变换</p>
<p>TF功能包</p>
<p><img src="https://s2.loli.net/2022/02/04/F2fNVWSZaBz4gMY.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> sudo apt-get install ros-melodic-turtle-tf</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">roslaunch,启动脚本文件</span><br><span class="hljs-meta">$</span><span class="bash"> roslaunch turtle_tf turtle_tf_demo.launch</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun turtlesim turtle_teleop_key</span><br><span class="hljs-meta"></span><br><span class="hljs-meta">#</span><span class="bash">各种工具</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun tf view_frames</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun tf tf_echo turtle1 turtle2</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun rviz rviz -d `rospack find turtle_tf`/rviz/turtle_rviz.rviz</span><br></code></pre></div></td></tr></tbody></table></figure>
<p><img src="https://s2.loli.net/2022/02/04/j847hsINPvUE1YG.png" srcset="/img/loading2.gif" lazyload alt=""></p>
</li>
</ul>
<h2 id="TF坐标系广播监听的编程管理"><a href="#TF坐标系广播监听的编程管理" class="headerlink" title="TF坐标系广播监听的编程管理"></a>TF坐标系广播监听的编程管理</h2><ul>
<li><p>创建功能包</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws/src</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_create_pkg learning_tf roscpp rospy tf turtlesim</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>广播器broadcaster.cpp</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 该例程产生tf数据，并计算、发布turtle2的速度指令</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;tf/transform_broadcaster.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;turtlesim/Pose.h&gt;</span></span><br><br>std::string turtle_name;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">poseCallback</span><span class="hljs-params">(<span class="hljs-keyword">const</span> turtlesim::PoseConstPtr&amp; msg)</span></span><br><span class="hljs-function"></span>{<br>	<span class="hljs-comment">// 创建tf的广播器</span><br>	<span class="hljs-keyword">static</span> tf::TransformBroadcaster br;<br><br>	<span class="hljs-comment">// 初始化tf数据</span><br>	tf::Transform transform;<br>	transform.<span class="hljs-built_in">setOrigin</span>( tf::<span class="hljs-built_in">Vector3</span>(msg-&gt;x, msg-&gt;y, <span class="hljs-number">0.0</span>) );<br>	tf::Quaternion q;<br>	q.<span class="hljs-built_in">setRPY</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, msg-&gt;theta);<br>	transform.<span class="hljs-built_in">setRotation</span>(q);<br><br>	<span class="hljs-comment">// 广播world与海龟坐标系之间的tf数据</span><br>	br.<span class="hljs-built_in">sendTransform</span>(tf::<span class="hljs-built_in">StampedTransform</span>(transform, ros::Time::<span class="hljs-built_in">now</span>(), <span class="hljs-string">"world"</span>, turtle_name));<br>}<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span></span><br><span class="hljs-function"></span>{<br>    <span class="hljs-comment">// 初始化ROS节点</span><br>	ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">"my_tf_broadcaster"</span>);<br><br>	<span class="hljs-comment">// 输入参数作为海龟的名字</span><br>	<span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>)<br>	{<br>		<span class="hljs-built_in">ROS_ERROR</span>(<span class="hljs-string">"need turtle name as argument"</span>); <br>		<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>	}<br><br>	turtle_name = argv[<span class="hljs-number">1</span>];<br><br>	<span class="hljs-comment">// 订阅海龟的位姿话题</span><br>	ros::NodeHandle node;<br>	ros::Subscriber sub = node.<span class="hljs-built_in">subscribe</span>(turtle_name+<span class="hljs-string">"/pose"</span>, <span class="hljs-number">10</span>, &amp;poseCallback);<br><br>    <span class="hljs-comment">// 循环等待回调函数</span><br>	ros::<span class="hljs-built_in">spin</span>();<br><br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>};<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>监听器</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 该例程监听tf数据，并计算、发布turtle2的速度指令</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;ros/ros.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;tf/transform_listener.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;geometry_msgs/Twist.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;turtlesim/Spawn.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span>** argv)</span></span><br><span class="hljs-function"></span>{<br>	<span class="hljs-comment">// 初始化ROS节点</span><br>	ros::<span class="hljs-built_in">init</span>(argc, argv, <span class="hljs-string">"my_tf_listener"</span>);<br><br>    <span class="hljs-comment">// 创建节点句柄</span><br>	ros::NodeHandle node;<br><br>	<span class="hljs-comment">// 请求产生turtle2</span><br>	ros::service::<span class="hljs-built_in">waitForService</span>(<span class="hljs-string">"/spawn"</span>);<br>	ros::ServiceClient add_turtle = node.serviceClient&lt;turtlesim::Spawn&gt;(<span class="hljs-string">"/spawn"</span>);<br>	turtlesim::Spawn srv;<br>	add_turtle.<span class="hljs-built_in">call</span>(srv);<br><br>	<span class="hljs-comment">// 创建发布turtle2速度控制指令的发布者</span><br>	ros::Publisher turtle_vel = node.advertise&lt;geometry_msgs::Twist&gt;(<span class="hljs-string">"/turtle2/cmd_vel"</span>, <span class="hljs-number">10</span>);<br><br>	<span class="hljs-comment">// 创建tf的监听器</span><br>	tf::TransformListener listener;<br><br>	<span class="hljs-function">ros::Rate <span class="hljs-title">rate</span><span class="hljs-params">(<span class="hljs-number">10.0</span>)</span></span>;<br>	<span class="hljs-keyword">while</span> (node.<span class="hljs-built_in">ok</span>())<br>	{<br>		<span class="hljs-comment">// 获取turtle1与turtle2坐标系之间的tf数据</span><br>		tf::StampedTransform transform;<br>		<span class="hljs-keyword">try</span><br>		{<br>			listener.<span class="hljs-built_in">waitForTransform</span>(<span class="hljs-string">"/turtle2"</span>, <span class="hljs-string">"/turtle1"</span>, ros::<span class="hljs-built_in">Time</span>(<span class="hljs-number">0</span>), ros::<span class="hljs-built_in">Duration</span>(<span class="hljs-number">3.0</span>));<br>			listener.<span class="hljs-built_in">lookupTransform</span>(<span class="hljs-string">"/turtle2"</span>, <span class="hljs-string">"/turtle1"</span>, ros::<span class="hljs-built_in">Time</span>(<span class="hljs-number">0</span>), transform);<br>		}<br>		<span class="hljs-built_in"><span class="hljs-keyword">catch</span></span> (tf::TransformException &amp;ex) <br>		{<br>			<span class="hljs-built_in">ROS_ERROR</span>(<span class="hljs-string">"%s"</span>,ex.<span class="hljs-built_in">what</span>());<br>			ros::<span class="hljs-built_in">Duration</span>(<span class="hljs-number">1.0</span>).<span class="hljs-built_in">sleep</span>();<br>			<span class="hljs-keyword">continue</span>;<br>		}<br><br>		<span class="hljs-comment">// 根据turtle1与turtle2坐标系之间的位置关系，发布turtle2的速度控制指令</span><br>		geometry_msgs::Twist vel_msg;<br>		vel_msg.angular.z = <span class="hljs-number">4.0</span> * <span class="hljs-built_in">atan2</span>(transform.<span class="hljs-built_in">getOrigin</span>().<span class="hljs-built_in">y</span>(),<br>				                        transform.<span class="hljs-built_in">getOrigin</span>().<span class="hljs-built_in">x</span>());<br>		vel_msg.linear.x = <span class="hljs-number">0.5</span> * <span class="hljs-built_in">sqrt</span>(<span class="hljs-built_in">pow</span>(transform.<span class="hljs-built_in">getOrigin</span>().<span class="hljs-built_in">x</span>(), <span class="hljs-number">2</span>) +<br>				                      <span class="hljs-built_in">pow</span>(transform.<span class="hljs-built_in">getOrigin</span>().<span class="hljs-built_in">y</span>(), <span class="hljs-number">2</span>));<br>		turtle_vel.<span class="hljs-built_in">publish</span>(vel_msg);<br><br>		rate.<span class="hljs-built_in">sleep</span>();<br>	}<br>	<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>};<br><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>编译配置</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">add_executable(turtle_tf_broadcaster src/turtle_tf_broadcaster.cpp)<br>target_link_libraries(turtle_tf_broadcaster ${catkin_LIBRARIES})<br><br>add_executable(turtle_tf_listener src/turtle_tf_listener.cpp)<br>target_link_libraries(turtle_tf_listener ${catkin_LIBRARIES})<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>编译运行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">cd</span> ~/catkin_ws</span><br><span class="hljs-meta">$</span><span class="bash"> catkin_make</span><br><span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> devel/setup.bash</span><br><span class="hljs-meta">$</span><span class="bash"> roscore</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun turtlesim turtlesim_node</span><br><span class="hljs-meta">#</span><span class="bash">重命名，避免冲突</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun learning_tf turtle_tf_broadcaster __name:=turtle1_tf_broadcaster /turtle1</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun learning_tf turtle_tf_broadcaster __name:=turtle2_tf_broadcaster /turtle2</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun learning_tf turtle_tf_listener</span><br><span class="hljs-meta">$</span><span class="bash"> rosrun turtlesim turtle_teleop_key</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
</ul>
<h2 id="launch启动文件的使用方法"><a href="#launch启动文件的使用方法" class="headerlink" title="launch启动文件的使用方法"></a>launch启动文件的使用方法</h2><p><a target="_blank" rel="noopener" href="http://wiki.ros.org/roslaunch/XML">roslaunch/XML - ROS Wiki</a></p>
<ul>
<li><p>Launch文件：通过XML文件实现多节点的配置和启动（可自动启动ROS Master）</p>
</li>
<li><p>node启动节点 ：</p>
<p>pkg：节点所在的功能包名称 </p>
<p>type：节点的可执行文件名称 </p>
<p>name：节点运行时的名称 </p>
<p>output 、respawn 、required 、ns 、args</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">"package-name"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"executable-name"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"node-name"</span> /&gt;</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>参数设置</p>
<p><img src="https://s2.loli.net/2022/02/04/tMn1vPh9YaHbxUw.png" srcset="/img/loading2.gif" lazyload alt=""></p>
</li>
</ul>
<p><img src="https://s2.loli.net/2022/02/04/K1I6VJjr8okv4LC.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p><img src="C:/Users/71041/AppData/Roaming/Typora/typora-user-images/image-20220204095104412.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<p><img src="https://s2.loli.net/2022/02/04/Q538qRmdMCoSznU.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<h2 id="常用可视化工具"><a href="#常用可视化工具" class="headerlink" title="常用可视化工具"></a>常用可视化工具</h2><ul>
<li><p>rqt</p>
<p><img src="https://s2.loli.net/2022/02/04/YuZwK5z1vXqSyWR.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">rqt<br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>Rviz</p>
<p><img src="https://s2.loli.net/2022/02/04/vUdFafQKJ7bzOxs.png" srcset="/img/loading2.gif" lazyload alt=""></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> rosrun rviz</span><br></code></pre></div></td></tr></tbody></table></figure>
</li>
<li><p>Gazebo</p>
<p><img src="https://s2.loli.net/2022/02/04/hfjqVNXPDWgdmpJ.png" srcset="/img/loading2.gif" lazyload alt=""></p>
</li>
</ul>
<p><img src="https://s2.loli.net/2022/02/04/QwdoXSkv97e23ZD.png" srcset="/img/loading2.gif" lazyload alt=""></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/ROS/">ROS</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ROS/">ROS</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/02/08/C++_QT1/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Qt入门</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/30/ROS1/">
                        <span class="hidden-mobile">ROS之消息通信</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"UrMBdkpVtSriHxFtNjQRvPqm-gzGzoHsz","appKey":"rLGXsY7AM0Ym431NbB2fCRpX","path":"window.location.pathname","placeholder":"发一条友善的评论","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->

  <div class="col-lg-7 mx-auto nopadding-x-md">
    <div class="container custom post-custom mx-auto">
      <p style="text-align:center;">如果博文对你有帮助，可以给博主充充电噢~ <br> 非常感谢！！</p><img src="/img/qxd.jpg" srcset="/img/loading2.gif" lazyload class="rounded mx-auto d-block mt-5" style="width:150px; height:150px;">
    </div>
  </div>


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  

  

  

  

  

  




  
<script src="/js/diy/timeDate.js"></script>
<script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/metowolf/Metingjs@1.2/dist/Meting.min.js"></script>
<script src="//cdn.jsdelivr.net/gh/bynotes/texiao/source/js/xiantiao.js"></script>



<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"}});</script></body>
</html>
